<div class="container">
  <div class="row">
    <div class="col-xs-12">
      <h1>Order <%= @order.id %></h1>
      Order Status: <%= @order.order_status %><br>
      <%= link_to "Fulfill Order<br>".html_safe, dashboard_order_fulfill_path if @order[:order_status] < Order.order_statuses[:fulfilled] %>
      <%= link_to "Cancel Order<br>".html_safe, dashboard_order_cancel_path if @order[:order_status] < Order.order_statuses[:fulfilled] %>
      <p>
        Sub-total: <%= number_to_currency(@order.sub_total, :unit => "$") %><br>
        <% if @order.discount_code_valid? %>
          Discount code used: <%= @order.discount_code %><br>
          <% if @order.get_discount.multiplier %>
            Percent discount: <%= @order.get_discount.percentage %>%<br>
          <% end %>
          <% if @order.get_discount.deduction && @order.get_discount.deduction > 0 %>
            Deduction: -<%= number_to_currency(@order.get_discount.deduction, :unit => "$") %><br>
          <% end %>
          Sub-total after discount: <%= number_to_currency(@order.sub_total_after_discount, :unit => "$") %>
        <% end %>
      </p>
      Shipping: <%= number_to_currency(@order.shipping_method.price, :unit => "$") %><br>
      Order Total: <%= number_to_currency(@order.total, :unit => "$") %><br>
      Cart ID <%= @order.cart.id %>:
      <table class="table table-bordered">
        <thead>
          <tr>
            <td>Product</td>
            <td>Listing</td>
            <td>Quantity</td>
            <td>Price at Sale</td>
          </tr>
        </thead>
        <tbody>
          <% for item in @order.cart.line_items %>
            <tr>
              <td><%= item.persisted_name %></td>
              <td><%= item.persisted_listing_name %></td>
              <td><%= item.quantity %></td>
              <td><%= number_to_currency(item.persisted_price, :unit => "$") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <%= link_to "Back to Orders", dashboard_orders_path %>
    </div>
  </div>
</div>